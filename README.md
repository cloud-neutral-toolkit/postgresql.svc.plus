# PostgreSQL Service Plus

ç”Ÿäº§å°±ç»ªçš„ PostgreSQL è¿è¡Œæ—¶,åŒ…å«å‘é‡æœç´¢ã€ä¸­æ–‡åˆ†è¯ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ‰©å±•,æ”¯æŒå¤šç§å®‰å…¨éƒ¨ç½²æ¨¡å¼ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. æ„å»ºé•œåƒ
make build-postgres-image

# 2. ç”Ÿæˆè¯ä¹¦
cd deploy/docker && ./generate-certs.sh

# 3. å¯åŠ¨æœåŠ¡ (PostgreSQL + Stunnel TLS éš§é“)
docker-compose -f docker-compose.yml -f docker-compose.tunnel.yml up -d

# 4. å®¢æˆ·ç«¯è¿æ¥ (é€šè¿‡ TLS éš§é“)
psql "host=localhost port=5433 user=postgres dbname=postgres"
```

**è¯¦ç»†æŒ‡å—**: æŸ¥çœ‹ [docs/QUICKSTART.md](docs/QUICKSTART.md)

## ğŸ“¦ æ ¸å¿ƒç‰¹æ€§

### å¤šæ¨¡å‹æ•°æ®åº“

ä¸€ä¸ª PostgreSQL å®ä¾‹æ›¿ä»£å¤šä¸ªä¸“ç”¨æ•°æ®åº“:

| ä¼ ç»Ÿæ–¹æ¡ˆ | PostgreSQL æ‰©å±• | ç”¨é€” |
|---------|----------------|------|
| Pinecone | **pgvector** | å‘é‡åµŒå…¥å’Œè¯­ä¹‰æœç´¢ |
| Elasticsearch | **pg_jieba + pg_trgm** | ä¸­æ–‡åˆ†è¯å’Œå…¨æ–‡æœç´¢ |
| Kafka | **pgmq** | è½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ— |
| MongoDB | **JSONB + GIN** | æ–‡æ¡£å­˜å‚¨ |
| Redis | **hstore + UNLOGGED** | é«˜é€Ÿé”®å€¼ç¼“å­˜ |

### å®‰å…¨æ¶æ„

- âœ… PostgreSQL åªç›‘å¬å®¹å™¨å†…éƒ¨ (127.0.0.1:5432)
- âœ… æ‰€æœ‰å¤–éƒ¨è®¿é—®é€šè¿‡ **stunnel4 TLS éš§é“** (HTTPS ç«¯ç‚¹)
- âœ… å®¢æˆ·ç«¯ä½¿ç”¨æœ¬åœ° stunnel (localhost:15432)
- âœ… åº”ç”¨æ— éœ€é…ç½® SSL,é€æ˜åŠ å¯†
- âœ… æ”¯æŒåŒå‘ TLS è®¤è¯

### 6 ç§éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼ | å¤æ‚åº¦ | HTTPS | TLSéš§é“ | é€‚ç”¨åœºæ™¯ |
|------|--------|-------|---------|----------|
| åŸºç¡€ + Stunnel | â­ | âŒ | âœ… | å¼€å‘æµ‹è¯• |
| Nginx + Certbot | â­â­ | âœ… è‡ªåŠ¨ | âœ… | å°å‹ç”Ÿäº§ |
| Caddy | â­â­ | âœ… è‡ªåŠ¨ | âœ… | å°å‹ç”Ÿäº§ |
| Kubernetes/Helm | â­â­â­ | æ‰‹åŠ¨ | âœ… | ä¼ä¸šç”Ÿäº§ |

## ğŸ“š æ–‡æ¡£

### å¿«é€Ÿå¯¼èˆª

- **[å¿«é€Ÿå¼€å§‹](docs/QUICKSTART.md)** - 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²
- **[é¡¹ç›®ç»“æ„](docs/PROJECT_STRUCTURE.md)** - äº†è§£é¡¹ç›®ç»„ç»‡
- **[å®Œæ•´æ–‡æ¡£ç´¢å¼•](docs/README.md)** - æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨

### éƒ¨ç½²æŒ‡å—

- **[Docker éƒ¨ç½²](docs/deployment/docker-deployment.md)** - Docker Compose å®Œæ•´æŒ‡å—
- **[Helm éƒ¨ç½²](docs/deployment/helm-deployment.md)** - Kubernetes ç”Ÿäº§éƒ¨ç½²
- **[åŸºç¡€é•œåƒ](docs/deployment/base-images.md)** - é•œåƒæ„å»ºè¯´æ˜

### å®‰å…¨æŒ‡å—

- **[Stunnel æœåŠ¡ç«¯](docs/guides/stunnel-server.md)** - TLS éš§é“æœåŠ¡ç«¯é…ç½®
- **[Stunnel å®¢æˆ·ç«¯](docs/guides/stunnel-client.md)** - å®¢æˆ·ç«¯éƒ¨ç½²å’Œåº”ç”¨è¿æ¥

## ğŸ”§ Makefile å‘½ä»¤

```bash
make help                    # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make build-postgres-image    # æ„å»º PostgreSQL é•œåƒ
make push-postgres-image     # æ¨é€é•œåƒåˆ°ä»“åº“
make test-postgres          # æœ¬åœ°æµ‹è¯•
make deploy-docker          # Docker Compose éƒ¨ç½²
make deploy-helm            # Helm éƒ¨ç½²
make clean                  # æ¸…ç†æµ‹è¯•å®¹å™¨
```

## ğŸ—ï¸ æ¶æ„å›¾

### å®‰å…¨è®¿é—®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨æœåŠ¡å™¨ (ä»»æ„ä½ç½®)                                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚  åº”ç”¨ç¨‹åº     â”‚  æ™®é€š PostgreSQL è¿æ¥                      â”‚
â”‚  â”‚  (DB/API/Web) â”‚  localhost:15432                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  æ— éœ€ sslmode                             â”‚
â”‚         â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ stunnel å®¢æˆ·ç«¯â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ HTTPS/TLS åŠ å¯† (Internet)
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“æœåŠ¡å™¨                                                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ stunnel æœåŠ¡ç«¯â”‚  0.0.0.0:5433 (HTTPS ç«¯ç‚¹)                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚         â”‚ è§£å¯†è½¬å‘                                           â”‚
â”‚         â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚  PostgreSQL  â”‚  127.0.0.1:5432 (å†…éƒ¨éš”ç¦»)                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### Python åº”ç”¨

```python
import psycopg2

# é€šè¿‡ stunnel å®¢æˆ·ç«¯è¿æ¥ - æ— éœ€ SSL é…ç½®
conn = psycopg2.connect(
    host="localhost",  # stunnel å®¢æˆ·ç«¯
    port=15432,
    user="postgres",
    password="password",
    database="dbname"
)
```

### Node.js åº”ç”¨

```javascript
const { Client } = require('pg');

const client = new Client({
  host: 'localhost',  // stunnel å®¢æˆ·ç«¯
  port: 15432,
  user: 'postgres',
  password: 'password',
  database: 'dbname'
  // æ— éœ€ SSL é…ç½®
});
```

### ç¯å¢ƒå˜é‡

```bash
DATABASE_URL=postgresql://postgres:password@localhost:15432/dbname
```

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **ç½‘ç»œéš”ç¦»**: PostgreSQL ä¸ç›´æ¥æš´éœ²
2. **å¼ºåˆ¶åŠ å¯†**: æ‰€æœ‰è¿æ¥é€šè¿‡ TLS 1.2/1.3
3. **è¯ä¹¦éªŒè¯**: æ”¯æŒåŒå‘ TLS è®¤è¯
4. **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„è¿æ¥æ—¥å¿—
5. **è‡ªåŠ¨è¯ä¹¦**: Nginx + Certbot æˆ– Caddy

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- é¢„é…ç½®çš„ PostgreSQL æ€§èƒ½å‚æ•°
- SSD ä¼˜åŒ– (random_page_cost = 1.1)
- è¿æ¥æ± æ”¯æŒ (PgBouncer)
- èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **PostgreSQL**: 16.4 (PGDG)
- **æ‰©å±•**: pgvector 0.8.1, pg_jieba 2.0.1, pgmq 1.8.0
- **TLS éš§é“**: stunnel4
- **åå‘ä»£ç†**: Nginx + Certbot æˆ– Caddy
- **å®¹å™¨ç¼–æ’**: Docker Compose æˆ– Kubernetes/Helm

## ğŸ“ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®! è¯·æŸ¥çœ‹æ–‡æ¡£å¹¶æäº¤ Pull Requestã€‚

## ğŸ“ æ”¯æŒ

- **æ–‡æ¡£**: [docs/](docs/)
- **é—®é¢˜**: GitHub Issues
- **ä¸­æ–‡æ–‡æ¡£**: [docs/ç²¾ç®€æ€»ç»“.md](docs/ç²¾ç®€æ€»ç»“.md)

---

**ä¸€ä¸ª PostgreSQL,æ›¿ä»£å¤šä¸ªæ•°æ®åº“** ğŸš€
