; stunnel 客户端配置 - PostgreSQL TLS over HTTPS 隧道
; 
; 设计目标:
; - 应用程序使用普通 PostgreSQL 连接 (localhost:15432)
; - 无需配置 PostgreSQL sslmode
; - stunnel 自动处理 HTTPS 加密
; - DB/API/Web 可以部署在任何位置
;
; 使用方法:
;   psql -h localhost -p 15432 -U postgres -d postgres
;   或在应用中: postgresql://postgres:password@localhost:15432/dbname

[postgres-client]
; 客户端模式 - 连接到远程 HTTPS 端点
client = yes

; 本地监听端口 - 应用连接到这个端口
accept = 127.0.0.1:15432

; 远程 HTTPS 端点 (stunnel 服务端)
; 修改为您的实际服务器地址
connect = db.example.com:5433

; 客户端证书 (用于 Mutual TLS 认证)
cert = /etc/stunnel/certs/client-cert.pem
key = /etc/stunnel/certs/client-key.pem

; 服务端证书验证 (生产环境建议启用)
verify = 2
CAfile = /etc/stunnel/certs/ca-cert.pem
; checkHost = db.example.com

; TLS 协议配置
sslVersion = TLSv1.2
options = NO_SSLv2
options = NO_SSLv3
options = NO_TLSv1
options = NO_TLSv1.1
ciphers = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384

; 日志配置
debug = 5
output = /var/log/stunnel/stunnel-client.log

; 性能优化
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
socket = l:SO_KEEPALIVE=1
socket = r:SO_KEEPALIVE=1

; 连接重试
retry = yes

; 超时设置
TIMEOUTclose = 0
TIMEOUTidle = 43200
