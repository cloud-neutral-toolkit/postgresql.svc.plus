; stunnel configuration for PostgreSQL TLS tunnel
; Server mode - accepts TLS connections and forwards to PostgreSQL

[postgres-server]
; Run as TLS server
client = no

; Listen on port 5433 for TLS connections
accept = 0.0.0.0:5433

; Forward to local PostgreSQL
connect = postgres:5432

; TLS certificate (generate with: openssl req -new -x509 -days 365 -nodes -out cert.pem -keyout cert.pem)
cert = /etc/stunnel/certs/server-cert.pem
key = /etc/stunnel/certs/server-key.pem

; Optional: Require client certificates
; verify = 2
; CAfile = /etc/stunnel/certs/ca-cert.pem

; TLS options
sslVersion = TLSv1.2
options = NO_SSLv2
options = NO_SSLv3
ciphers = HIGH:!aNULL:!MD5

; Logging
debug = 5
output = /var/log/stunnel/stunnel.log

; Performance
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
